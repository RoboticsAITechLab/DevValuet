-- Flyway baseline: create offline module tables
CREATE TABLE IF NOT EXISTS offline_project (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  created_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS offline_dataset (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  project_id BIGINT,
  created_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS offline_git_connection (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  provider VARCHAR(255) NOT NULL,
  provider_user_id VARCHAR(255) NOT NULL,
  provider_email VARCHAR(1024),
  token VARCHAR(4096),
  created_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS offline_snapshot (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  data VARCHAR(65536),
  created_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS offline_changeset (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  entity_type VARCHAR(255) NOT NULL,
  entity_id BIGINT NOT NULL,
  payload VARCHAR(8192),
  created_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS offline_sync_state (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  sync_key VARCHAR(255) NOT NULL,
  sync_value VARCHAR(4096),
  updated_at TIMESTAMP
);
